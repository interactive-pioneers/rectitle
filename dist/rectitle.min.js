"use strict";function RecTitle(a){return this.defaults={fontFamily:"Helvetica",fontSize:48,fontColor:"#fff",fontMask:!1,fontOpacity:1,backgroundColor:"#000",backgroundOpacity:.75,backgroundPadding:{left:10,top:0,right:10,bottom:0},transformMatrix:{m11:0,m12:0,m21:0,m22:0,dx:0,dy:0},"class":"rectitle",id:null},this.view=null,this._target=null,this._text=null,this._dimensions={width:null,height:null},this._init(a),this}RecTitle.prototype._init=function(a){this.options=this._merge(a,this.defaults),this._initView()},RecTitle.prototype._initView=function(){this.view=document.createElement("canvas"),this.view.setAttribute("class",this.options.class),this.view.setAttribute("style","backrgound-color:transparent;"),this.options.id&&this.view.setAttribute("id",this.options.id)},RecTitle.prototype.hasTransformMatrix=function(){for(var a in this.options.transformMatrix)if(0!==this.options.transformMatrix[a])return!0;return!1},RecTitle.prototype.render=function(a){return this.setTarget(a),this._dimensions=this._calculateDimensions(),this.view.setAttribute("width",this._dimensions.width),this.view.setAttribute("height",this._dimensions.height),this._draw()?this.emptyTarget().appendChild(this.view):!1},RecTitle.prototype.emptyTarget=function(){for(var a=this.getTarget();a.firstChild;)a.removeChild(a.firstChild);return a},RecTitle.prototype._calculateDimensions=function(){var a=this.getTextWidth(this.getText())+this.options.backgroundPadding.left+this.options.backgroundPadding.right,b=this.options.fontSize+this.options.backgroundPadding.top+this.options.backgroundPadding.bottom;return this._getTransformedDimensions(a,b)},RecTitle.prototype._getTransformedDimensions=function(a,b){var c,d={width:a,height:b,original:{width:a,height:b},shift:{x:0,y:0}};if(0!==this.options.transformMatrix.m12&&(c=Math.atan(this.options.transformMatrix.m12),d.height=Math.abs(Math.tan(c)*a)+b,d.shift.y=d.height-d.original.height),0!==this.options.transformMatrix.m21){c=Math.atan(this.options.transformMatrix.m21);var e=Math.tan(c)*b;d.width=2*e+a,Math.abs(e)!==e&&(d.shift.x=Math.tan(c)*b)}return d},RecTitle.prototype._draw=function(){var a=this.view.getContext("2d");return a.font=this.options.fontSize+"px "+this.options.fontFamily,this.hasTransformMatrix()&&a.transform(this.options.transformMatrix.m11,this.options.transformMatrix.m12,this.options.transformMatrix.m21,this.options.transformMatrix.m22,this.options.transformMatrix.dx,this.options.transformMatrix.dy),a.fillStyle=this.options.backgroundColor,a.fillRect(this._dimensions.shift.x,this._dimensions.shift.y,this._dimensions.width-this._dimensions.shift.x,this._dimensions.height-this._dimensions.shift.y),this.options.fontMask===!0?a.globalCompositeOperation="destination-out":a.fillStyle=this.options.fontColor,a.fillText(this.getText(),this.options.backgroundPadding.left+this._dimensions.shift.x,this._dimensions.original.height-this.options.backgroundPadding.bottom),a},RecTitle.prototype.getTextWidth=function(a){var b=document.createElement("canvas"),c=3072,d=this.options.fontSize+10;b.setAttribute("width",c),b.setAttribute("height",d);var e=b.getContext("2d");return e.font=this.options.fontSize+"px "+this.options.fontFamily,e.textAlign="center",e.fillStyle="black",e.fillText(a,.5*c,.5*d),e.measureText(a).width},RecTitle.prototype.setText=function(a){if(!("string"==typeof a&&a.length>0))throw new TypeError("Invalid text object, non-zero string expected!");return this._text=a,this._text},RecTitle.prototype.getText=function(){if(this._text)return this._text;var a=this.getTarget().textContent;return this.setText(a)},RecTitle.prototype.setTarget=function(a){if(!a||!a.tagName)throw new TypeError("HTMLElement expected for target!");return this._target=a,this._target},RecTitle.prototype.getTarget=function(){return this._target},RecTitle.prototype._merge=function(a,b){for(var c in a)void 0!==b[c]&&(b[c]=a[c]);return b};